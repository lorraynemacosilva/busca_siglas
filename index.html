<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca de Siglas - SEI Pedro Leopoldo</title>
    
    <!-- Importa a fonte Poppins do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700;800&display=swap" rel="stylesheet">

    <!-- O script do Tailwind CDN deve vir antes da sua configuração personalizada -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuração personalizada do Tailwind com as cores da sua marca -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-light-blue': '#77C4EE',
                        'brand-dark-blue': '#2D537F',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F1F5F9;
        }
        /* Estilo para o tooltip */
        .info-tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 10;
        }
        .info-container:hover .info-tooltip {
            visibility: visible;
            opacity: 1;
        }
        /* Estilo para a lista de autocomplete */
        .autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-top: none;
            z-index: 5;
        }
        .autocomplete-item:hover {
            background-color: #f0f4f8;
        }
        /* Estilos para a hierarquia */
        .hierarchy-chevron {
            transition: transform 0.2s ease-in-out;
        }
        .hierarchy-chevron-down {
            transform: rotate(90deg);
        }
        /* Estilo para o link do título */
        .header-link {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }
        .header-link:hover h1 {
            opacity: 0.9;
            text-decoration: underline;
        }
    </style>
</head>
<body class="bg-slate-100 p-4 sm:p-8">

<div class="container mx-auto max-w-4xl bg-white rounded-2xl shadow-2xl p-6 sm:p-10 space-y-8">
    <!-- Cabeçalho -->
    <header class="mb-6">
        <div class="flex items-center justify-between">
            <!-- Logo Esquerda -->
            <img src="assets/baixados-removebg-preview.png" alt="Logo da Prefeitura de Pedro Leopoldo" class="h-16 w-16 sm:h-20 sm:w-20 object-contain">
            
            <!-- Título como Link -->
            <a href="#" onclick="clearSearch()" class="header-link">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-brand-dark-blue">Busca Siglas</h1>
            </a>
            
            <!-- Logo Direita (com hyperlink) -->
            <a href="http://pedroleopoldo.sei.mg.gov.br/sei" target="_blank" class="header-link">
                <img src="assets/sei_logo-removebg-preview.png" alt="Logo do SEI" class="h-16 w-16 sm:h-20 sm:w-20 object-contain">
            </a>
        </div>
        <p class="mt-2 text-xl font-light text-slate-600 text-center">Busque e compreenda as siglas das unidades SEI.</p>
    </header>

    <main class="space-y-8">
        
        <!-- Seção de Busca -->
        <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 shadow-sm">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-brand-dark-blue">Buscar Sigla </h2>
                <!-- Ícone de Informação (Tooltip) -->
                <div class="info-container relative cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-brand-dark-blue" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div class="info-tooltip absolute top-8 right-0 w-80 bg-brand-light-blue bg-opacity-95 p-4 rounded-lg shadow-lg">
                        <h3 class="text-white font-bold mb-2">Lógica de Criação das Siglas</h3>
                        <ul class="list-disc list-inside text-sm text-white space-y-1">
                            <li><strong class="font-bold">Prefixos:</strong> Siglas para unidades subordinadas começam com um prefixo, como <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">SECA</span> (Secretarias Adjuntas), <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">COO</span> (Coordenadorias), <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">DIR</span> (Diretorias), <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">GER</span> (Gerências), e <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">NUC</span> (Núcleos).</li>
                            <li><strong class="font-bold">Duplicidade de Unidades:</strong> Para unidades com o mesmo nome em secretarias diferentes, as duas últimas ou a última letra da sigla da secretaria são adicionadas como um prefixo (ex: <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">GF</span>ASSCOM para SGF e <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">I</span>ASSCOM para SMI).</li>
                            <li><strong class="font-bold">Coordenadorias Administrativas:</strong> Coordenadorias administrativas e de assessoramento recebem as duas últimas letras da sigla da secretaria no final, precedidas pela letra <span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">A</span> (ex: COOA<span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">MA</span> para SMA e COOA<span class="font-mono bg-blue-100 p-1 rounded-sm text-brand-dark-blue">DE</span> para SDE).</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="relative flex flex-col sm:flex-row gap-4 items-center">
                <div class="relative w-full sm:flex-1">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <input type="text" id="search-input" placeholder="Digite a sigla, órgão ou unidade..."
                           class="w-full p-3 pl-10 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-dark-blue transition duration-300">
                    <div id="autocomplete-list" class="autocomplete-list hidden bg-white rounded-b-lg shadow-lg"></div>
                </div>
                <button onclick="performSearch()"
                        class="w-full sm:w-auto px-6 py-3 bg-brand-dark-blue text-white font-normal rounded-lg shadow-md hover:bg-brand-dark-blue hover:bg-opacity-90 transition duration-300">
                    Buscar
                </button>
            </div>
        </div>

        <!-- Seção de Resultados -->
        <div id="results-container" class="space-y-4">
            <!-- Os resultados serão injetados aqui -->
        </div>

        <!-- Seção de Fontes -->
        <div class="bg-slate-50 p-6 rounded-xl border border-slate-200 shadow-sm">
            <h2 class="text-2xl font-bold text-brand-dark-blue mb-4">Fontes</h2>
            <ul class="list-disc list-inside text-slate-700 font-normal space-y-2">
                <li><strong class="text-slate-900">Fontes para a definição das siglas:</strong>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li><a href="http://www.diariooficial.rj.gov.br/documents/10180/2996160/2020-10-30-Decreto+47339-2020.pdf" target="_blank" class="text-brand-dark-blue hover:underline">DECRETO Nº 47.339 DE 29 DE OUTUBRO DE 2020</a> (Padroniza siglas no Sistema Eletrônico de Informações - SEI-RJ)</li>
                        <li><a href="https://www.cmbh.mg.gov.br/comunicacao/guia-de-redacao" target="_blank" class="text-brand-dark-blue hover:underline">Uso das siglas</a> (Guia de Redação da Câmara Municipal de Belo Horizonte - CMBH)</li>
                    </ul>
                </li>
                <li><strong class="text-slate-900">Fontes para as organizações:</strong>
                    <p class="mt-2">Decretos nº 2401, 2413, 2425, 2403, 2021, 2415, 2409, 2399, 2405, 2411, 2420, 2423, 2407, 2417.</p>
                </li>
            </ul>
        </div>
    </main>
</div>

<script>
    const data = [
        { "sigla": "COOCOM", "orgao": "Gabinete (GAB)", "unidade": "Coordenadoria de Comunicação" },
        { "sigla": "DIRSEG", "orgao": "Gabinete (GAB)", "unidade": "Diretoria de Segurança Institucional" },
        { "sigla": "DIRTLEN", "orgao": "Assessoria Executiva (ASE)", "unidade": "Diretoria de Técnica Legislativa e Normativa" },
        { "sigla": "DIRPE", "orgao": "Assessoria Executiva (ASE)", "unidade": "Diretoria de Projetos Especiais" },
        { "sigla": "DIRGO", "orgao": "Assessoria Executiva (ASE)", "unidade": "Diretoria de Governança" },
        { "sigla": "GERCI", "orgao": "Controladoria Geral do Município (CGM)", "unidade": "Gerência de Controle Interno" },
        { "sigla": "GERAI", "orgao": "Controladoria Geral do Município (CGM)", "unidade": "Gerência de Auditoria Interna" },
        { "sigla": "CGMOUVI", "orgao": "Controladoria Geral do Município (CGM)", "unidade": "Ouvidoria Municipal" },
        { "sigla": "CORREG", "orgao": "Controladoria Geral do Município (CGM)", "unidade": "Corregedoria Municipal" },
        { "sigla": "PROCA", "orgao": "Procuradoria Geral do Município (PGM)", "unidade": "Procurador Adjunto" },
        { "sigla": "DIRCONS", "orgao": "Procuradoria Geral do Município (PGM)", "unidade": "Diretoria Consultiva" },
        { "sigla": "DIRCONT", "orgao": "Procuradoria Geral do Município (PGM)", "unidade": "Diretoria Contenciosa" },
        { "sigla": "DIRPRAES", "orgao": "Procuradoria Geral do Município (PGM)", "unidade": "Diretoria de Processos Administrativos Especiais" },
        { "sigla": "SATD", "orgao": "Secretaria de Governo (GOV)", "unidade": "Secretaria Adjunta de Transformação Digital" },
        { "sigla": "COOTI", "orgao": "Secretaria Adjunta de Transformação Digital (SECATD)", "unidade": "Coordenadoria de Tecnologia da Informação" },
        { "sigla": "COOMIN", "orgao": "Secretaria Adjunta de Transformação Digital (SECATD)", "unidade": "Coordenadoria de Modernização e Inovação" },
        { "sigla": "DIREG", "orgao": "Secretaria de Governo (GOV)", "unidade": "Diretoria Executiva de Governo" },
        { "sigla": "SARI", "orgao": "Secretaria de Governo (GOV)", "unidade": "Secretaria Adjunta de Relações Institucionais" },
        { "sigla": "GFASSCOM", "orgao": "Secretaria de Gestão e Finanças (SGF)", "unidade": "Assessoria de Comunicação" },
        { "sigla": "ASSADM", "orgao": "Secretaria de Gestão e Finanças (SGF)", "unidade": "Assessoria Administrativa" },
        { "sigla": "NUCQG", "orgao": "Secretaria de Gestão e Finanças (SGF)", "unidade": "Núcleo de Qualidade do Gasto" },
        { "sigla": "SAGADM", "orgao": "Secretaria de Gestão e Finanças (SGF)", "unidade": "Secretaria Adjunta de Gestão e Administração" },
        { "sigla": "DIRCOMP", "orgao": "Secretaria Adjunta de Gestão e Administração (SECAGADM)", "unidade": "Diretoria de Compras Públicas" },
        { "sigla": "COOPLOG", "orgao": "Secretaria Adjunta de Gestão e Administração (SECAGADM)", "unidade": "Coordenadoria de Patrimônio e Logística" },
        { "sigla": "DIRGEP", "orgao": "Secretaria Adjunta de Gestão de Administração (SECAGADM)", "unidade": "Diretoria de Gestão de Pessoas" },
        { "sigla": "SAFINT", "orgao": "Secretaria de Gestão e Finanças (SGF)", "unidade": "Secretaria Adjunta de Finanças e Tesouraria" },
        { "sigla": "DIRCON", "orgao": "Secretaria Adjunta de Finanças e Tesouraria (SECAFINT)", "unidade": "Diretoria de Contabilidade" },
        { "sigla": "DIRRTF", "orgao": "Secretaria Adjunta de Finanças e Tesouraria (SECAFINT)", "unidade": "Diretoria de Receita, Tributação e Fiscalização" },
        { "sigla": "DIRTO", "orgao": "Secretaria Adjunta de Finanças e Tesouraria (SECAFINT)", "unidade": "Diretoria de Tesouraria e Orçamento" },
        { "sigla": "APOGAB", "orgao": "Secretaria de Saúde (SMS)", "unidade": "Apoio ao Gabinete" },
        { "sigla": "SASSCOM", "orgao": "Secretaria de Saúde (SMS)", "unidade": "Assessoria de Comunicação" },
        { "sigla": "SOUVI", "orgao": "Secretaria de Saúde (SMS)", "unidade": "Ouvidoria" },
        { "sigla": "SAPMAC", "orgao": "Secretaria de Saúde (SMS)", "unidade": "Secretaria Adjunta de Planejamento e Média e Alta Complexidade" },
        { "sigla": "COOPLAR", "orgao": "Secretaria Adjunta de Planejamento e Média e Alta Complexidade (SECAPMAC)", "unidade": "Coordenação de Planejamento e Regulação" },
        { "sigla": "DIRHOSM", "orgao": "Secretaria Adjunta de Planejamento e Média e Alta Complexidade (SECAPMAC)", "unidade": "Diretoria do Hospital Municipal" },
        { "sigla": "COOPALA", "orgao": "Secretaria Adjunta de Planejamento e Média e Alta Complexidade (SECAPMAC)", "unidade": "Coordenação do Pronto Atendimento Lagoa" },
        { "sigla": "SAAPV", "orgao": "Secretaria de Saúde (SMS)", "unidade": "Secretaria Adjunta de Atenção Primária e Vigilância em Saúde" },
        { "sigla": "COOVIS", "orgao": "Secretaria Adjunta de Atenção Primária e Vigilância em Saúde (SECAAPV)", "unidade": "Coordenação de Vigilância em Saúde" },
        { "sigla": "COOATP", "orgao": "Secretaria Adjunta de Atenção Primária e Vigilância em Saúde (SECAAPV)", "unidade": "Coordenação de Atenção Primária" },
        { "sigla": "COOINFE", "orgao": "Secretaria Adjunta de Atenção Primária e Vigilância em Saúde (SECAAPV)", "unidade": "Coordenação de Informações Estratégicas" },
        { "sigla": "COOSAB", "orgao": "Secretaria Adjunta de Atenção Primária e Vigilância em Saúde (SECAAPV)", "unidade": "Coordenação de Saúde Bucal" },
        { "sigla": "SAGAF", "orgao": "Secretaria de Saúde (SMS)", "unidade": "Secretaria Adjunta de Gestão Administrativa e Financeira" },
        { "sigla": "COOPED", "orgao": "Secretaria de Educação (SME)", "unidade": "Coordenadoria Pedagógica" },
        { "sigla": "COOENS", "orgao": "Secretaria de Educação (SME)", "unidade": "Coordenadoria de Ensino" },
        { "sigla": "SAEX", "orgao": "Secretaria de Educação (SME)", "unidade": "Secretaria Adjunta Executiva" },
        { "sigla": "COOADM", "orgao": "Secretaria de Infraestrutura (SMI)", "unidade": "Coordenação Administrativa" },
        { "sigla": "IASSCOM", "orgao": "Secretaria de Infraestrutura (SMI)", "unidade": "Assessoria de Comunicação" },
        { "sigla": "SECALU", "orgao": "Secretaria de Infraestrutura (SMI)", "unidade": "Secretaria Adjunta de Limpeza Urbana" },
        { "sigla": "SAPU", "orgao": "Secretaria de Infraestrutura (SMI)", "unidade": "Secretaria Adjunta de Planejamento Urbano" },
        { "sigla": "SAOSP", "orgao": "Secretaria de Infraestrutura (SMI)", "unidade": "Secretaria Adjunta de Obras e Serviços Públicos" },
        { "sigla": "NUCADMBE", "orgao": "Secretaria de Bem-Estar (SBE)", "unidade": "Núcleo Administrativo" },
        { "sigla": "DIRLA", "orgao": "Secretaria de Bem-Estar (SBE)", "unidade": "Diretoria de Lazer" },
        { "sigla": "SAELJ", "orgao": "Secretaria de Bem-Estar (SBE)", "unidade": "Secretaria Adjunta de Esportes, Lazer e Juventude" },
        { "sigla": "SACPH", "orgao": "Secretaria de Bem-Estar (SBE)", "unidade": "Secretaria Adjunta de Cultura e Patrimônio Histórico" },
        { "sigla": "NUCADMDS", "orgao": "Secretaria de Desenvolvimento Social (SDS)", "unidade": "Núcleo de Administração" },
        { "sigla": "COOASIP", "orgao": "Secretaria de Desenvolvimento Social (SDS)", "unidade": "Coordenadoria de Assistência Social e Inclusão Produtiva" },
        { "sigla": "COOASPD", "orgao": "Secretaria de Desenvolvimento Social (SDS)", "unidade": "Coordenadoria de Abordagem Social e Política sobre Drogas" },
        { "sigla": "COODH", "orgao": "Secretaria de Desenvolvimento Social (SDS)", "unidade": "Coordenadoria de Direitos Humanos" },
        { "sigla": "NUCADMSP", "orgao": "Secretaria de Segurança Pública (SSP)", "unidade": "Núcleo Administrativo" },
        { "sigla": "COMGCM", "orgao": "Secretaria de Segurança Pública (SSP)", "unidade": "Comando da Guarda Civil Municipal" },
        { "sigla": "COOMDC", "orgao": "Secretaria de Segurança Pública (SSP)", "unidade": "Coordenadoria Municipal de Defesa Civil" },
        { "sigla": "GERTMU", "orgao": "Secretaria de Segurança Pública (SSP)", "unidade": "Gerência de Trânsito e Mobilidade Urbana" },
        { "sigla": "COOAMA", "orgao": "Secretaria de Meio Ambiente (SMA)", "unidade": "Coordenadoria Administrativa e Assessoria" },
        { "sigla": "GERFISC", "orgao": "Secretaria de Meio Ambiente (SMA)", "unidade": "Gerência de Fiscalização" },
        { "sigla": "GERPAPR", "orgao": "Secretaria de Meio Ambiente (SMA)", "unidade": "Gerência de Parques e Praças Municipais" },
        { "sigla": "COOADE", "orgao": "Secretaria de Desenvolvimento Econômico (SDE)", "unidade": "Coordenadoria Administrativa e de Assessoramento" },
        { "sigla": "DIRIC", "orgao": "Secretaria de Desenvolvimento Econômico (SDE)", "unidade": "Diretoria de Indústria e Comércio" },
        { "sigla": "DIRTUR", "orgao": "Secretaria de Desenvolvimento Econômico (SDE)", "unidade": "Diretoria de Turismo" },
        { "sigla": "CEAC", "orgao": "Secretaria de Desenvolvimento Econômico (SDE)", "unidade": "Coordenadoria do Centro de Atendimento ao Cidadão" },
        { "sigla": "DIRDA", "orgao": "Secretaria de Desenvolvimento Econômico (SDE)", "unidade": "Diretoria de Desenvolvimento Agrícola" }
    ];

    /**
     * Constrói a hierarquia dos dados com base nos campos "orgao" e "unidade".
     * @param {Array} data O array de objetos de dados.
     * @returns {Array} A árvore de hierarquia.
     */
    const buildHierarchy = (data) => {
        const nodes = new Map();
        
        // Passo 1: Cria um nó para cada unidade e mapeia pelo nome da unidade
        data.forEach(item => {
            const fullName = item.unidade.trim() + (item.sigla ? ` - ${item.sigla}` : '');
            nodes.set(item.unidade.trim(), { ...item, fullName, children: [] });
        });

        const roots = [];

        // Passo 2: Constrói a hierarquia
        data.forEach(item => {
            const parentNameMatch = item.orgao.match(/^(.*) \((.*)\)$/);
            const parentName = parentNameMatch ? parentNameMatch[1].trim() : item.orgao.trim();
            const parentNode = nodes.get(parentName);
            const currentNode = nodes.get(item.unidade.trim());

            if (parentNode) {
                // Se o pai é outro nó no nosso mapa, adiciona o nó atual como filho
                parentNode.children.push(currentNode);
            } else {
                // Se o pai não está no nosso mapa, ele é um nó raiz
                const existingRoot = roots.find(r => r.unidade === parentName);
                if (!existingRoot) {
                    const parentSigla = parentNameMatch ? parentNameMatch[2].trim() : null;
                    const rootNode = {
                        unidade: parentName,
                        sigla: parentSigla,
                        fullName: parentName + (parentSigla ? ` - ${parentSigla}` : ''),
                        children: [currentNode]
                    };
                    roots.push(rootNode);
                } else {
                    existingRoot.children.push(currentNode);
                }
            }
        });
        
        // Remove nós duplicados que se tornaram raízes
        const finalRoots = roots.filter(root => {
            const isChildOfAnotherNode = Array.from(nodes.values()).some(node =>
                node.unidade !== root.unidade && node.children.some(child => child.unidade === root.unidade)
            );
            return !isChildOfAnotherNode;
        });
        
        // Ordena os nós para uma exibição consistente
        const sortNodes = (arr) => {
            arr.sort((a, b) => a.unidade.localeCompare(b.unidade));
            arr.forEach(node => {
                if (node.children.length > 0) {
                    sortNodes(node.children);
                }
            });
        };
        sortNodes(finalRoots);
        
        return finalRoots;
    };

    const hierarchyTree = buildHierarchy(data);

    /**
     * Renderiza a hierarquia completa ou os resultados de busca.
     * @param {Array} items O array de objetos de dados.
     * @param {boolean} isSearch Indica se os resultados são de uma busca.
     */
    function renderResults(items, isSearch = false) {
        const container = document.getElementById('results-container');
        container.innerHTML = ''; // Limpa os resultados anteriores

        // A lógica do botão 'clear-search-btn' foi removida, pois a função foi integrada ao título principal.

        if (items.length === 0) {
            // Exibe uma mensagem se não houver resultados
            container.innerHTML = `
                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200 shadow-sm text-yellow-800">
                    <p class="text-center font-normal">Nenhum resultado encontrado. Tente outra busca.</p>
                </div>
            `;
        } else {
            if (isSearch) {
                // Renderiza a lista plana de resultados de busca
                items.forEach(item => {
                    const cardHtml = `
                        <div class="bg-brand-light-blue bg-opacity-20 p-6 rounded-xl border border-slate-200 shadow-sm transition-transform transform hover:scale-[1.01]">
                            <p class="text-xs font-light text-slate-500 mb-1 flex items-center">
                                ${item.orgao}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                </svg>
                            </p>
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                                <h3 class="text-2xl font-bold text-brand-dark-blue">${item.sigla}</h3>
                                <p class="text-md font-normal text-slate-600 sm:text-right mt-2 sm:mt-0">${item.unidade}</p>
                            </div>
                        </div>
                    `;
                    container.innerHTML += cardHtml;
                });
            } else {
                // Renderiza a hierarquia completa
                function renderNode(node, level = 0) {
                    const hasChildren = node.children && node.children.length > 0;
                    const chevronHtml = hasChildren ? `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-400 hierarchy-chevron" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                        </svg>
                    ` : `<div class="w-5 h-5 mr-2 text-transparent"></div>`;

                    const html = `
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 mb-2">
                            <div class="p-4 flex items-center cursor-pointer" onclick="toggleChildren(this)">
                                ${chevronHtml}
                                <h3 class="font-semibold text-brand-dark-blue">${node.unidade}${node.sigla ? ` - ${node.sigla}` : ''}</h3>
                            </div>
                            ${hasChildren ? `<div class="children-container hidden p-4 pt-0 space-y-2">
                                ${node.children.map(child => renderNode(child, level + 1)).join('')}
                            </div>` : ''}
                        </div>
                    `;
                    return html;
                }
                
                hierarchyTree.forEach(node => {
                    container.innerHTML += renderNode(node);
                });
            }
        }
    }

    /**
     * Expande ou contrai os nós da hierarquia.
     * @param {HTMLElement} element O elemento clicado.
     */
    function toggleChildren(element) {
        const parent = element.parentElement;
        const container = parent.querySelector('.children-container');
        const chevron = element.querySelector('.hierarchy-chevron');
        
        if (container) {
            container.classList.toggle('hidden');
            if (chevron) {
                chevron.classList.toggle('hierarchy-chevron-down');
            }
        }
    }

    /**
     * Realiza a busca nos dados com base no valor do campo de entrada.
     */
    function performSearch() {
        const input = document.getElementById('search-input').value.toLowerCase().trim();
        if (input === '') {
            renderResults(hierarchyTree);
            return;
        }

        const filteredData = data.filter(item =>
            item.sigla.toLowerCase().includes(input) ||
            item.orgao.toLowerCase().includes(input) ||
            item.unidade.toLowerCase().includes(input)
        );
        renderResults(filteredData, true);
    }
    
    /**
     * Limpa a busca e retorna à exibição inicial.
     */
    function clearSearch() {
        const searchInput = document.getElementById('search-input');
        searchInput.value = '';
        searchInput.focus();
        document.getElementById('autocomplete-list').classList.add('hidden');
        renderResults(hierarchyTree);
    }
    
    /**
     * Filtra e exibe sugestões de autocompletar.
     */
    function showSuggestions(input) {
        const autocompleteList = document.getElementById('autocomplete-list');
        autocompleteList.innerHTML = '';
        
        if (input.length === 0) {
            autocompleteList.classList.add('hidden');
            return;
        }

        const filtered = data.filter(item =>
            item.sigla.toLowerCase().includes(input) ||
            item.unidade.toLowerCase().includes(input)
        ).slice(0, 5); // Limita a 5 sugestões

        if (filtered.length > 0) {
            filtered.forEach(item => {
                const suggestionDiv = document.createElement('div');
                suggestionDiv.classList.add('p-2', 'cursor-pointer', 'autocomplete-item', 'border-b', 'border-gray-200');
                suggestionDiv.innerHTML = `<span class="font-bold text-brand-dark-blue">${item.sigla}</span> - ${item.unidade}`;
                suggestionDiv.onclick = () => {
                    document.getElementById('search-input').value = item.sigla;
                    autocompleteList.classList.add('hidden');
                    performSearch();
                };
                autocompleteList.appendChild(suggestionDiv);
            });
            autocompleteList.classList.remove('hidden');
        } else {
            autocompleteList.classList.add('hidden');
        }
    }

    // Carrega todos os dados na página ao iniciar
    window.addEventListener('DOMContentLoaded', () => {
        renderResults(hierarchyTree);
    });

    // Adiciona o evento de busca ao pressionar a tecla Enter no campo de busca
    document.getElementById('search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            performSearch();
            document.getElementById('autocomplete-list').classList.add('hidden');
        }
    });
    
    // Adiciona o evento de input para o autocompletar
    document.getElementById('search-input').addEventListener('input', (e) => {
        showSuggestions(e.target.value.toLowerCase().trim());
    });
    
</script>

</body>
</html>





